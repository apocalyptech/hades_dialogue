fsb-vorbis-extractor Tweaks
===========================

I'd been using [fsb-vorbis-extractor](https://github.com/tmiasko/fsb-vorbis-extractor)
to extract the Hades game audio for awhile, since that was the first tool
I'd come across which generated proper Ogg Vorbis extracts.  That project
has a couple of deficiencies on the Hades voiceover dataset, though,
namely:

1. Processing the FSB file properly required a few source tweaks (and
   subsequent recompilation)
2. Eight of the files generated by fsb-vorbis-extractor end up being
   corrupt and don't sound right at all.  Fortunately only two end up
   being used by this utility anyway, and they were both quite minor,
   but it's still a *bit* annoying.

Anyway, what follows is the original notes I'd had about using
fsb-vorbis-extractor to extract Hades voiceover audio for use in this
project.  I now recommend [python-fsb5](https://github.com/HearthSim/python-fsb5)
instead.  Works great, and since you're theoretically already running
Python to run my dialogue player, using another Python script is
probably up your alley anyway.

Extracting Audio Files
----------------------

As mentioned above, the game's `VO.fsb` file (in `Content/Audio/FMOD/Build/Desktop`),
needs to be extracted to get access to the actual Ogg files.
[fsb-vorbis-extractor](https://github.com/tmiasko/fsb-vorbis-extractor)
is one project which can do so, though it requires a few tweaks to the
source -- a few files in `VO.fsb` end up tripping assertions in the code.

First, line 162 of `src/fsb/container.cpp` needs to be commented -- there's
apparently a header in this FSB which the util doesn't know about, and
its presence prevents the app from doing anything with the file.
Commenting the line doesn't appear to cause any problems for extracting
the file, though (this is reported in [PR #1](https://github.com/tmiasko/fsb-vorbis-extractor/pull/1)
on that project, fwiw):

```patch
diff --git a/src/fsb/container.cpp b/src/fsb/container.cpp
index e58daf8..41f46a2 100644
--- a/src/fsb/container.cpp
+++ b/src/fsb/container.cpp
@@ -159,7 +159,7 @@ sample container::read_sample_header(io::buffer_view & view) {
         view.skip(extra_length);
         break;
       default:
-        CHECK(false) << "Unexpected extra header type: " << type;
+        //CHECK(false) << "Unexpected extra header type: " << type;
         view.skip(extra_length);
     }
   }
```

Secondly, line 125 of `src/fsb/vorbis/rebuilder.cpp` does some CRC32
checking on some Vorbis-specific headers.  The check fails when trying to
extract a handful of files inside the archive, and when it does so, it
interrupts the rest of the extraction process.  Commenting out the check
allows the extraction process to continue to other files.  The affected
files end up sounding completely distorted, so clearly the check knows
what it's talking about, but the impact of not having these eight files
is pretty minor.  The patch in question (this is reported in
[PR #2](https://github.com/tmiasko/fsb-vorbis-extractor/pull/2) on
that project, fwiw):

```patch
diff --git a/src/fsb/vorbis/rebuilder.cpp b/src/fsb/vorbis/rebuilder.cpp
index 1f57929..0926155 100644
--- a/src/fsb/vorbis/rebuilder.cpp
+++ b/src/fsb/vorbis/rebuilder.cpp
@@ -122,8 +122,8 @@ void rebuilder::rebuild_headers(

   const auto i =
     std::lower_bound(headers, headers_end, crc32, headers_info_crc32_less());
-  CHECK(i != headers_end && i->crc32 == crc32)
-    << "Headers with CRC-32 equal " << crc32 << " not found.";
+  /*CHECK(i != headers_end && i->crc32 == crc32)
+    << "Headers with CRC-32 equal " << crc32 << " not found.";*/

   rebuild_id_header(channels, rate, i->blocksize_short, i->blocksize_long, id);
   rebuild_comment_header(comment, loop_start, loop_end);
```

Here's the files which are affected by this:

* `Charon_0032` - On-hit cue when Charon gets damaged, saying *"Hmmmm....!"*
* `Charon_0038` - Occurs during Charon's `CharonAboutHermes03`,
  `CharonPostEnding02`, `BossCharonEncounter01`, and
  `BossCharonAboutHermesQuest01` dialogues:
  *"Mmnnn{#DialogueItalicFormat}rraaauuugggghhh{#PreviousFormat}!!"*
* `Intercom_0097` - In `SurvivalEncounterStartVoiceLines`, Hades saying
  *"You dare?"*
* `Intercom_0312` - In `PerfectClearEncounterFailedVoiceLines`, Hades
  saying *"Aww.'*
* `Intercom_0419` - In `SurvivalEncounterSurvivedVoiceLines`, Hades
  saying *"All right, break it up!"*
* `Intercom_0857` - In `PerfectClearEncounterQuicklyFailedVoiceLines`,
  Hades saying *"Hah, haha."*
* `Nyx_0255` - Occurs in Megaera's `MegaeraWithNyx04` conversation,
  Nyx replying *"Mmm."* at the end.
* `Tisiphone_0075` - Not actually used in-game anywhere; commented out
  from Tisiphone's `CauseOfDeathVoiceLines` in the game data.

Of those eight, only two (`Charon_0038` and `Nyx_0255`) actually show up
as playable dialogue in this project.

